<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–°–í–û–Ø –ö–£–•–ù–Ø ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'PT Sans Narrow',Arial,sans-serif;
  background:#f7efe0;
}
.header{
  background:#556B2F;
  color:#fff;
  text-align:center;
  padding:20px;
}
.menu{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:16px;
  padding:16px;
  max-width:1000px;
  margin:auto;
}
.product{
  background:#fff;
  border-radius:12px;
  padding:12px;
  border:2px solid #6b7a29;
  text-align:center;
}
.product img{
  width:100px;height:100px;
  border-radius:10px;
  object-fit:cover;
}
.controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
}
button{
  cursor:pointer;
  border-radius:6px;
  border:none;
  padding:6px 10px;
}
.add-btn{background:#556B2F;color:#fff;}
.remove-btn{background:#eee;}
.cart-fab{
  position:fixed;
  right:16px;
  bottom:16px;
  width:64px;
  height:64px;
  border-radius:50%;
  background:#b3611f;
  color:#fff;
  font-size:24px;
  display:none;
}
.cart-modal-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  justify-content:center;
  align-items:flex-start;
}
.cart-modal{
  background:#fff;
  margin-top:40px;
  padding:16px;
  border-radius:12px;
  width:90%;
  max-width:420px;
}
</style>
</head>

<body>

<div class="header">
  <h1>–°–í–û–Ø –ö–£–•–ù–Ø</h1>
  <div>–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã</div>
</div>

<div id="menu" class="menu"></div>

<button id="cartFab" class="cart-fab">üõí<span id="cartCount"></span></button>

<div id="cartModalBg" class="cart-modal-bg"></div>

<script>
// ================= –ù–ê–°–¢–†–û–ô–ö–ò API =================
const SHEET_API_URL =
  'https://sheets.googleapis.com/v4/spreadsheets/SPREADSHEET_ID/values/Sheet1?key=API_KEY';

const SHEET_API_FALLBACK =
  'https://script.google.com/macros/s/AKfycbyytR-HwA0y-TnHS_7nygs-_ZkPHDYzQQWFgV3GJSVuvdn93oX0kP92Ti9bQVqW7C_gFg/exec';

const TELEGRAM_BOT_TOKEN = '8543195311:AAGzpZwTaUAgw3qp6AeKQA_BbFX35jtbJIk';
const TELEGRAM_CHAT_ID = '7567253745';

// ================= –î–ê–ù–ù–´–ï =================
let menuData = [];
let cart = {};

const VND = new Intl.NumberFormat('vi-VN', {
  style:'currency',
  currency:'VND',
  maximumFractionDigits:0
});

// ================= –ó–ê–ì–†–£–ó–ö–ê –ú–ï–ù–Æ =================
async function loadMenu(){
  try{
    const res = await fetch(SHEET_API_URL);
    if(!res.ok) throw 1;
    const json = await res.json();
    const rows = json.values;
    const headers = rows[0].map(h=>h.toLowerCase());
    menuData = rows.slice(1).map((r,i)=>{
      const o={}; headers.forEach((h,j)=>o[h]=r[j]);
      return {
        id:i+1,
        name:o.name,
        description:o.description||'',
        img:o.img||'https://via.placeholder.com/100',
        price:Number(o.price)||0,
        available:String(o.available).toLowerCase()==='true'
      };
    });
  }catch{
    const res = await fetch(SHEET_API_FALLBACK);
    const json = await res.json();
    menuData = json.menu.map((i,idx)=>({
      id:idx+1,
      name:i.name,
      description:i.description||'',
      img:i.img||'https://via.placeholder.com/100',
      price:Number(i.price)||0,
      available:String(i.available).toLowerCase()==='true'
    }));
  }
  renderMenu();
}

// ================= –†–ï–ù–î–ï–† =================
function renderMenu(){
  const el = document.getElementById('menu');
  el.innerHTML='';
  menuData.forEach(i=>{
    const d=document.createElement('div');
    d.className='product';
    d.innerHTML=`
      <img src="${i.img}">
      <div><b>${i.name}</b></div>
      <div>${i.description}</div>
      <div>${VND.format(i.price)}</div>
      <div class="controls">
        <button class="remove-btn" onclick="updateCart(${i.id},-1)">‚àí</button>
        <span id="q${i.id}">${cart[i.id]?.qty||0}</span>
        <button class="add-btn" onclick="updateCart(${i.id},1)">+</button>
      </div>
    `;
    el.appendChild(d);
  });
  updateCartFab();
}

// ================= –ö–û–†–ó–ò–ù–ê =================
function updateCart(id,d){
  const item = menuData.find(i=>i.id===id);
  if(!cart[id]) cart[id]={...item,qty:0};
  cart[id].qty=Math.max(0,cart[id].qty+d);
  if(cart[id].qty===0) delete cart[id];
  document.getElementById('q'+id).textContent=cart[id]?.qty||0;
  updateCartFab();
}

function updateCartFab(){
  const c=Object.values(cart).reduce((s,i)=>s+i.qty,0);
  const fab=document.getElementById('cartFab');
  document.getElementById('cartCount').textContent=c||'';
  fab.style.display=c?'block':'none';
}

// ================= –ú–û–î–ê–õ–ö–ê =================
document.getElementById('cartFab').onclick=()=>{
  const bg=document.getElementById('cartModalBg');
  const items=Object.values(cart);
  const total=items.reduce((s,i)=>s+i.qty*i.price,0);
  bg.innerHTML=`
    <div class="cart-modal">
      <button onclick="closeCart()">‚úñ</button>
      ${items.map(i=>`${i.name} x${i.qty}<br>`).join('')}
      <hr>
      <b>${VND.format(total)}</b>
      <br><br>
      <button onclick="sendOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>`;
  bg.style.display='flex';
};
function closeCart(){document.getElementById('cartModalBg').style.display='none';}

// ================= –û–¢–ü–†–ê–í–ö–ê =================
async function sendOrder(){
  const items=Object.values(cart);
  if(!items.length) return;
  const text=
    'üõí –ù–æ–≤—ã–π –∑–∞–∫–∞–∑\n'+
    items.map(i=>`${i.name} x${i.qty}`).join('\n');
  await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({chat_id:TELEGRAM_CHAT_ID,text})
  });
  alert('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
  cart={};
  closeCart();
  renderMenu();
}

// ================= INIT =================
document.addEventListener('DOMContentLoaded',loadMenu);
</script>

</body>
</html>
